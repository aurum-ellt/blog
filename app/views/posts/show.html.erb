<% content_for(:title) { @post.title } %>

<% content_for :head do %>
  <%= auto_discovery_link_tag :atom, author_posts_url(format: :atom), title: "Feed" %>

  <%= tag.meta property: "author", content: @author.name %>
  <%= tag.meta property: "description", content: truncate(@post.body.to_plain_text, length: 250) %>
  <%= tag.meta property: "robots", content: "index, follow" %>

  <%= tag.meta property: "og:site_name", content: "Blog" %>
  <%= tag.meta property: "og:type", content: "article" %>
  <%= tag.meta property: "og:url", content: author_post_url(@author.slug, @post.slug) %>
  <%= tag.meta property: "og:title", content: @post.title %>
  <%= tag.meta property: "og:description", content: truncate(@post.body.to_plain_text, length: 250) %>
  <%= tag.meta property: "og:image", content: @author.avatar.present? ? url_for(@author.avatar) : image_url("user-circle.svg") %>

  <%= tag.meta property: "twitter:title", content: @post.title %>
  <%= tag.meta property: "twitter:description", content: truncate(@post.body.to_plain_text, length: 250) %>
  <%= tag.meta property: "twitter:image", content: @author.avatar.present? ? url_for(@author.avatar) : image_url("user-circle.svg") %>
  <%= tag.meta property: "twitter:card", content: "summary_large_image" %>
<% end %>

<div class="relative w-full">
  <header class="text-center mb-16">
    <%= link_to author_posts_path(@author.slug) do %>
      <%= image_tag @author.avatar.presence || "user-circle.svg", size: "48", class: "inline-flex rounded-full object-cover h-12" %>
      <p class="font-semibold text-xl mt-2"><%= @author.name.upcase %></p>
    <% end %>
  </header>

  <p class="text-center"><%= l @post.published_at, format: :full_date if @post.published_at.present? %></p>
  <h1 class="font-bold text-4xl text-center"><%= @post.title %></h1>

  <section class="my-16">
    <article><%= @post.body %></article>
  </section>

  <section class="text-center">
    <%= form_with scope: :subscriber, url: author_subscribers_path(@author.slug), class: "contents" do |form| %>
      <%= form.label :email_address, "Subscribe to get future posts via email", class: "block" %>
      <div class="inline-flex mt-4">
        <%= form.email_field :email_address, required: true, placeholder: "Enter your email address", class: "form-control border-r-transparent rounded-l-full" %>
        <%= form.submit "Subscribe", class: "btn btn-primary rounded-l-none" %>
      </div>
    <% end %>
  </section>

  <section class="mt-8">
    <div data-controller="clipboard" data-clipboard-success-content-value="Copied!">
      <%= hidden_field_tag :original_url, request.original_url, data: { clipboard_target: "source" } %>
      <button type="button" class="flex gap-x-2" data-action="click->clipboard#copy" data-clipboard-target="button">
        <%= image_tag "link.svg", size: 24 %>
        Copy to clipboard
      </button>
    </div>
  </section>

  <% if authenticated? %>
    <div class="absolute top-0 right-0">
      <div class="relative flex" data-controller="dropdown">
        <button type="button" class="text-base text-gray-900 font-semibold" data-action="dropdown#toggle click@window->dropdown#hide">
          <%= image_tag "ellipsis-horizontal-circle.svg", size: 24 %>
        </button>
        <div class="absolute right-0 top-8 border rounded shadow bg-white min-w-64 transition transform origin-top-right hidden" data-dropdown-target="menu" data-transition-enter-from="opacity-0 scale-95" data-transition-enter-to="opacity-100 scale-100" data-transition-leave-from="opacity-100 scale-100" data-transition-leave-to="opacity-0 scale-95">
          <ul class="flex flex-col gap-y-2 p-4">
            <li><%= link_to "Edit this post", edit_post_path(@post), class: "block text-base text-gray-600 font-normal hover:text-gray-900" %></li>
            <%= blog_post_life_cycle_options @post %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>
</div>
